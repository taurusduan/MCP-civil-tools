# MCP Server 開發架構

## 架構概述
- 基於FastAPI框架實現
- 使用 @mcp.tool() 裝飾器註冊工具函數
- 統一輸入輸出格式： {"success": bool, "data": any, "message": str}

## 工具開發規範
1. 函數註冊   
   - 必須使用 @mcp.tool() 裝飾器
   - 函數名稱應清晰描述工具功能
   - 參數需明確指定類型
2. 輸入輸出   
   - 輸入參數需有默認值
   - 返回值必須符合統一格式
   - 錯誤訊息應清晰明確
3. 文件規範   
   - 每個工具函數必須包含docstring
   - 說明功能、參數、返回值及範例
   - 使用中文註解
4. 錯誤處理   
   - 使用try-except捕獲異常
   - 返回錯誤時success=False
   - 錯誤訊息應包含詳細原因
5. 類型提示   
   - 所有參數需有類型提示
   - 返回值類型應明確
   - 使用自定義類型時需導入

## 最佳實踐
- 工具函數應保持單一職責
- 複雜計算應拆分到util模組
- 常用查詢函數應提供列表工具
- 遵循PEP8代碼風格

---

## 進階通用規範補充

### 1. API 版本管理
- 所有 API 需明確標註版本號（如 /v1/xxx），以利未來升級與相容性維護。
- 建議於 URL 路徑或 HTTP Header 中標示版本。

### 2. 統一日誌紀錄與錯誤追蹤
- 必須統一採用標準日誌格式（如 JSON），記錄請求、回應、錯誤與異常。
- 建議整合第三方錯誤追蹤服務（如 Sentry、Rollbar），以利問題追蹤與回報。

### 3. 測試與 CI/CD 流程
- 所有功能需具備單元測試與整合測試，確保穩定性。
- 建議配置自動化 CI/CD 流程（如 GitHub Actions、GitLab CI），自動執行測試與部署。

### 4. 參數驗證與安全性建議
- 所有 API 輸入參數必須嚴格驗證型別、範圍與格式，防止注入攻擊與資料異常。
- 建議採用 pydantic、Cerberus 等驗證工具。
- 輸出錯誤訊息時，避免洩漏敏感資訊。
- 建議實作 API 金鑰、Token 驗證等安全機制。

### 5. 多語系支援
- 回應訊息建議支援多語系（如 zh-TW、en-US），可依用戶需求切換。
- 可採用 i18n 套件或自訂語系字典。

### 6. 文件與維護
- 所有 API 需具備完整 Swagger/OpenAPI 文件，並隨版本更新。
- 重要設計決策、規範與注意事項需記錄於專案文件。

### 7. 其他最佳實踐
- 保持模組化設計，便於擴充與維護。
- 遵循單一職責原則與高內聚低耦合原則。
- 定期檢討與優化架構，根據實際需求調整規範。
